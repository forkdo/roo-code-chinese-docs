---
description: 了解 Roo Code 的令牌使用、成本计算和优化策略。学习如何有效管理 API 成本并设置请求限制。
keywords:
  - 限流
  - API 成本
  - 令牌使用
  - 成本优化
  - 自动批准限制
  - API 管理
image: /img/social-share.jpg
---

# 限流与成本

理解和管理 API 使用对于获得流畅且经济高效的 Roo Code 体验至关重要。本节介绍如何跟踪您的令牌使用情况和成本。限流默认为 0（禁用），通常不需要调整，现在按配置文件配置；有关如何设置限流的详细信息，请参阅 [API 配置文件](/features/api-configuration-profiles#creating-a-profile) 文档。

---

## 令牌使用

Roo Code 使用令牌与 AI 模型进行交互。令牌本质上是单词的片段。请求和响应中的令牌数量会影响处理时间和成本。

*   **输入令牌：** 这些是您提示中的令牌，包括系统提示、您的指令和提供的任何上下文（例如文件内容）。
*   **输出令牌：** 这些是 AI 模型在其响应中生成的令牌。

您可以在聊天历史记录中看到每次交互使用的输入和输出令牌数量。

---

## 成本计算

大多数 AI 提供商根据使用的令牌数量收费。价格因提供商和特定模型而异。

Roo Code 会根据配置模型的定价自动计算每次 API 请求的预估成本。此成本显示在聊天历史记录中，位于令牌使用量旁边。

对于具备推理能力的模型（例如 Gemini 3 Pro Preview 和其他公开单独“思考”或推理令牌的模型），当提供商报告时，Roo Code 现在其估算中包含普通令牌**和**推理/“思考”令牌。这可能使显示的令牌使用量和成本略高于旧版本，但它更好地匹配了提供商的实际计费方式。

**注意：**

*   成本计算是*估算值*。实际成本可能因提供商的计费方式而略有差异。
*   某些提供商可能提供免费层级或积分。请查看提供商的文档了解详细信息。
*   某些提供商提供提示缓存，可大幅降低成本。

### 限制自动批准的请求

为了进一步帮助管理 API 成本并防止意外支出，Roo Code 为自动批准的操作包含了一个“最大请求”设置。这允许您定义 Roo Code 在任务期间无需您的明确重新批准即可连续进行的 API 调用次数限制。

*   **工作原理：** 如果您设置了一个限制（例如 5 个请求），Roo Code 将执行最多 5 次自动批准的 API 调用。在进行第 6 次调用之前，它将暂停并提示您“重置并继续”，如下所示。
    <img src="/img/v3.18.0/v3.18.0-1.png" alt="警告消息，表示已达到自动批准请求限制。" width="600" />
    *达到自动批准请求限制时的通知。*
*   **配置：** 此限制在“自动批准操作”设置中配置。您可以设置特定数量或选择“无限制”。有关配置此和其他自动批准设置的详细步骤，请参阅 [自动批准操作文档](/features/auto-approving-actions)。
    <img src="/img/v3.18.0/v3.18.0.png" alt="在 Roo Code 设置中为自动批准操作设置最大请求限制。" width="600" />
    *为自动批准操作设置“最大请求”。*

此功能提供了额外的保护，特别是对于涉及多次 API 调用的复杂或长时间运行的任务。

---

## 优化令牌使用的提示

*   **保持简洁：** 在提示中使用清晰简洁的语言。避免不必要的词语或细节。
*   **仅提供相关上下文：** 有选择地使用上下文引用（`@file.ts`、`@folder/`）。仅包含与任务直接相关的文件。
*   **分解任务：** 将大任务分解为更小、更集中的子任务。
*   **使用自定义指令：** 提供自定义指令以指导 Roo Code 的行为，减少每次提示中冗长解释的需要。
*   **选择合适的模型：** 某些模型比其他模型更具成本效益。考虑对不需要大型模型全部功能的任务使用更小、更快的模型。
*   **使用模式：** 不同模式可以访问不同的工具，例如 `Architect` 无法修改代码，这使其在分析复杂代码库时成为安全的选择，无需担心意外允许昂贵的操作。
*   **未使用时禁用 MCP：** 如果您未使用 MCP（模型上下文协议）功能，请考虑在 [MCP 设置中禁用它](/features/mcp/using-mcp-in-roo#enabling-or-disabling-mcp-server-creation)，以显著减少系统提示的大小并节省令牌。

通过理解和管理您的 API 使用，您可以高效且经济地使用 Roo Code。