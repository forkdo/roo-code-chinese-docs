---
description: 通过代码操作，直接在编辑器中访问 Roo Code 的 AI 辅助功能。借助 VSCode 的灯泡系统，即时获得修复、解释和改进建议。
keywords:
  - 代码操作
  - 快速修复
  - 灯泡菜单
  - AI 辅助
  - VSCode 集成
  - 代码改进
  - 错误修复
image: /img/social-share.jpg
---

# 代码操作

代码操作通过 VSCode 的灯泡（快速修复）系统，在代码编辑器中直接提供 Roo Code AI 辅助功能。这一上下文感知功能会自动检测相关代码场景，并提供相应的 AI 驱动操作，无需切换到聊天界面。

<div style={{ position: 'relative', paddingBottom: '56.25%', height: 0, overflow: 'hidden' }}>
  <iframe
    src="https://www.youtube.com/embed/_Op3VfLPEu8"
    style={{
      position: 'absolute',
      top: 0,
      left: 0,
      width: '100%',
      height: '100%',
    }}
    frameBorder="0"
    allow="autoplay; encrypted-media"
    allowFullScreen
  ></iframe>
</div>

<div style={{ marginTop: '20px' }}></div>

---

## 什么是代码操作？

代码操作以灯泡图标（💡）的形式出现在编辑器的装订线区域（行号左侧）。也可通过右键上下文菜单或键盘快捷键访问。在以下情况下触发：

*   选中一段代码范围。
*   光标位于有问题的行（错误、警告或提示）。
*   通过命令调用。

点击灯泡图标、右键选择 "Roo Code"，或使用键盘快捷键（默认为 `Ctrl+.` 或 macOS 上的 `Cmd+.`），将显示可用操作的菜单。

---

## Roo Code 的代码操作

Roo Code 提供 5 种代码操作，但其可用性因上下文而异：

### 上下文菜单操作（右键）
*   **添加到上下文**：快速将选中的代码添加到与 Roo 的聊天中，包含文件名和行号，让 Roo 知道代码的确切来源。它在菜单中排在第一位，便于访问。
*   **解释代码**：请求 Roo Code 解释选中的代码。
*   **改进代码**：请求 Roo Code 对选中的代码提出改进建议。

### 其他操作
*   **修复代码**：通过灯泡菜单和命令面板（而非右键菜单）提供。请求 Roo Code 修复选中代码中的问题。
*   **新建任务**：使用选中的代码创建新任务。通过命令面板提供。

### 上下文感知操作
灯泡菜单会根据代码的当前状态智能显示不同的操作：

**对于有问题的代码**（当 VSCode 显示红色/黄色波浪线时）：
- **修复代码** - 获得逐步指导以解决特定错误或警告
- **添加到上下文** - 将有问题的代码添加到 Roo 的上下文中进行讨论

**对于干净的代码**（无诊断问题）：
- **解释代码** - 获得代码的详细解释
- **改进代码** - 获得优化建议和最佳实践
- **添加到上下文** - 将代码添加到 Roo 的上下文中进行进一步工作

有关诊断如何与代码操作集成的更多详细信息，请参阅 [诊断集成](/features/diagnostics-integration)。

### 添加到上下文深度解析

**添加到上下文** 操作在代码操作菜单中排在第一位，因此您可以快速将代码片段添加到对话中。使用它时，Roo Code 会包含文件名和行号以及代码。

这有助于 Roo 了解代码在项目中的确切上下文，从而提供更相关和准确的辅助。

提示：使用 macOS 的 Cmd+K Cmd+A 或 Windows/Linux 的 Ctrl+K Ctrl+A 快速将选区添加到上下文。参阅 [键盘快捷键](/features/keyboard-shortcuts)。

**示例聊天输入：**

```
你能解释一下这个函数吗？
@myFile.js:15:25
```

*（其中 `@myFile.js:15:25` 代表通过 "添加到上下文" 添加的代码）*

---

## 使用代码操作

使用 Roo Code 的代码操作有三种主要方式：

### 1. 从灯泡（💡）

1.  **选择代码**：选择要操作的代码。可以选择单行、多行或整块代码。
2.  **查找灯泡**：在选中代码旁边（或有错误/警告的行）的装订线区域会出现一个灯泡图标。
3.  **点击灯泡**：点击灯泡图标打开代码操作菜单。
4.  **选择操作**：从菜单中选择所需的 Roo Code 操作。
5.  **审查并批准**：Roo Code 将在聊天面板中提出解决方案。审查建议的更改并批准或拒绝。

### 2. 从右键上下文菜单

1.  **选择代码**：选择要操作的代码。
2.  **右键点击**：右键点击选中的代码打开上下文菜单。
3.  **选择 "Roo Code"**：从上下文菜单中选择 "Roo Code" 选项。子菜单将显示可用的 Roo Code 操作。
4.  **选择操作**：从子菜单中选择所需的操作。
5.  **审查并批准**：Roo Code 将在聊天面板中提出解决方案。审查建议的更改并批准或拒绝。

### 3. 从命令面板

1.  **选择代码**：选择要操作的代码。
2.  **打开命令面板**：按 `Ctrl+Shift+P`（Windows/Linux）或 `Cmd+Shift+P`（macOS）。
3.  **输入命令**：输入 "Roo Code" 过滤命令，然后选择相关的代码操作（例如，"Roo Code: 解释代码"）。操作将在最合理的上下文中应用（通常是当前活动的聊天任务，如果存在的话）。
4.  **审查并批准**：Roo Code 将在聊天面板中提出解决方案。审查建议的更改并批准或拒绝。

---

## 终端操作

Roo Code 还为终端输出提供类似的操作：

*   **终端：添加到上下文**：将选中的终端输出添加到聊天中
*   **终端：修复命令**：请求 Roo Code 修复失败的终端命令
*   **终端：解释命令**：请求 Roo Code 解释终端输出或命令

这些操作在终端中选中文本并右键点击时可用。

---

## 禁用/启用代码操作

您可以通过 VSCode 设置控制代码操作：

### 启用/禁用代码操作
- **设置**：[`roo-cline.enableCodeActions`](vscode://settings/roo-cline.enableCodeActions)
- **默认**：启用
- **描述**：控制 Roo Code 快速修复选项是否出现在编辑器中

访问此设置的方法：
1. 打开 VSCode 设置（`Ctrl/Cmd + ,`）
2. 搜索 "enableCodeActions"
3. 切换复选框以启用或禁用

---

## 自定义代码操作提示

您可以通过修改 **提示** 选项卡中的 "支持提示" 来自定义每种代码操作使用的提示。这允许您微调给 AI 模型的指令，并根据您的特定需求定制响应。

1.  **打开提示选项卡**：点击 Roo Code 顶部菜单栏中的 <Codicon name="notebook" /> 图标。
2. **找到 "支持提示"**：您将看到支持提示，包括 "增强提示"、"解释代码"、"改进代码" 和 "修复代码"。
3. **编辑提示**：修改要自定义的提示的文本区域中的文本。提示使用 `${placeholder}` 格式的占位符：
    - `${filePath}` - 当前文件的路径
    - `${selectedText}` - 当前选中的文本
    - `${diagnostics}` - 任何错误或警告消息（用于修复代码）- 详细信息请参阅 [诊断集成](/features/diagnostics-integration)
4. **点击 "完成"**：保存您的更改。

### 示例提示模板
```
请解释以下来自 ${filePath} 的代码：

${selectedText}
```

通过使用 Roo Code 的代码操作，您可以直接在编码工作流中快速获得 AI 驱动的辅助。这可以节省时间并帮助您编写更好的代码。

---

## 相关功能

- [诊断集成](/features/diagnostics-integration) - 了解 Roo Code 如何与 VSCode 的问题面板集成
- [上下文引用](/basic-usage/context-mentions) - 发现向 Roo Code 提供上下文的其他方式