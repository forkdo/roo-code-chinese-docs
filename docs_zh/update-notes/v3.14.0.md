---
description: 本次发布新增了 Gemini 提示词缓存功能，改进了多个工具，并对扩展程序进行了大量错误修复和增强。
---

# Roo Code 3.14.0 发布说明（2025-04-23）

本次发布新增了 Gemini 提示词缓存功能，改进了多个工具，并对扩展程序进行了大量错误修复和增强。

---

## Apply Diff 及其他主要文件编辑改进

*   改进 [`apply_diff`](/advanced-usage/available-tools/apply-diff)，使其更好地支持 **Google Gemini 2.5** 和其他模型
*   在更改获得批准后，自动关闭由编辑工具（`apply_diff`、`insert_content`、`search_and_replace`、`write_to_file`）打开的文件。这可避免编辑器中因 Roo 打开的文件过多而造成混乱，并有助于通过仅显示用户主动打开的文件来明确上下文。
*   新增 `search_and_replace` 工具。该工具可使用字面字符串或正则表达式在文件中查找并替换文本，还可选择在特定行范围内执行操作（感谢 samhvw8！）。
*   新增 `insert_content` 工具（现已弃用）。该工具可在文件的指定位置或末尾插入新行，而不修改现有内容（感谢 samhvw8！）。
*   已弃用 `append_to_file` 工具，建议改用 `insert_content`（使用 `line: 0`）。
*   当 [`write_to_file`](/advanced-usage/available-tools/write-to-file) 因缺少行数信息而失败时，正确回滚更改并建议替代工具
*   改进 [`apply_diff`](/advanced-usage/available-tools/apply-diff) 工具的进度指示（感谢 qdaxb！）
*   即使在 API 错误期间，也确保用户反馈被添加到对话历史中（感谢 System233！）
*   在恢复任务时防止重复出现 'TASK RESUMPTION' 提示（感谢 System233！）
*   修复取消 API 请求后错误消息有时未显示的问题（感谢 System233！）
*   在 diff 操作期间保留编辑器状态并防止标签页被取消固定（感谢 seedlord！）

---

## 上下文提及（Context Mentions）

*   在提及中使用 Material 图标表示文件和文件夹（感谢 elianiva！）
*   改进 Linux 上的图标渲染效果（感谢 elianiva！）
*   更好地处理上下文提及中的 `aftercursor` 内容（感谢 elianiva！）

    <img src="/img/v3.14.0/v3.14.0.png" alt="Warning indicator for active system prompt override" width="600" />

---

## Footgun Prompting（防误操作提示）

*   **上下文变量**：新增在自定义系统提示覆盖文件中插值上下文变量（`{{workspace}}`、`{{mode}}`、`{{language}}`、`{{shell}}`、`{{operatingSystem}}`）的功能，从而实现更动态的提示词（感谢 daniel-lxs！）。详情请参阅 [Footgun Prompting 文档](/advanced-usage/footgun-prompting#using-context-variables)。
*   **覆盖警告**：当当前模式启用了系统提示覆盖时，Roo Code 现在会在聊天输入框中显示警告指示器。

    <img src="/img/footgun-prompting/footgun-prompting-1.png" alt="Warning indicator for active system prompt override" width="600" />

---

## MCP 调整

*   支持在 MCP 配置中注入环境变量（感谢 NamesMT！）
*   修复将扩展拖动到另一个侧边栏时的 MCP Hub 错误
*   改进长 MCP 工具参数的显示效果

---

## 提供商更新

*   允许使用 Amazon Bedrock Marketplace ARN（感谢 mlopezr！）
*   在 Gemini 提供商中为 `gemini-2.5-pro-preview-03-25` 添加提示词缓存功能（Vertex 和 OpenRouter 即将推出！）
*   改进 Requesty 模型列表获取功能（感谢 dtrugman！）
*   使 VS Code LM 提供商正确显示模型信息（感谢 QuinsZouls！）
*   从 VS Code LM 提供商中移除不必要的计算（感谢 d-oit！）

---

## 错误修复、通用质量改进及其他

*   使 [`list_files`](/advanced-usage/available-tools/list-files) 工具更高效，并更智能地排除 `.git/` 等目录
*   改进任务大小计算的性能
*   为聊天行提供更好的加载反馈（感谢 elianiva！）
*   使用更合理的任务导出图标
*   修复 Windows 上以及使用 SSH 隧道时的文件拖放问题（感谢 NyxJae！）
*   修复“添加到上下文”代码操作中的插值错误（感谢 elianiva！）
*   修复重复的 'TASK RESUMPTION' 提示（感谢 System233！）
*   修复编辑器无工作区根目录时打开文件的问题
*   更改 API 提供商时，不要立即显示模型 ID 错误
*   改进 `focusInput` 命令的可靠性（感谢 hongzio！）
*   修复终端回车处理，确保进度条正确显示（感谢 Yikai-Liao！）
*   在评估中跟踪工具使用错误
*   在 WebView 源文件中使用路径别名
*   更好地处理 FakeAI 的 “controller” 对象（感谢 wkordalski）